cd C:\work\bbitai\felho_lab

cd ..
docker compose -f pdocker-compose.yml build

cd felho_lab
kubectl delete deployment photo-ui
kubectl delete deployment photo-service
kubectl apply -f manifests.yaml
kubectl get pod

helm repo add traefik https://traefik.github.io/charts
helm repo update

helm uninstall traefik
helm list --all-namespaces

helm install traefik traefik/traefik --set ports.web.nodePort=32080 --set service.type=NodePort --set "additionalArguments={--api.insecure=true}"
helm upgrade traefik traefik/traefik --set ports.web.nodePort=32080 --set service.type=NodePort --set "additionalArguments={--api.insecure=true}"

helm install traefik traefik/traefik -f traefik-values.yaml
helm upgrade traefik traefik/traefik -f traefik-values.yaml

kubectl delete deployment photo-service
kubectl delete deployment photo-ui
kubectl delete deployment sqlserver
kubectl get deployment

kubectl logs photo-service-service-
kubectl describe pod photo-service-

kubectl port-forward pod/sqlserver-5f5585b58-bjj8j 1434:1433
127.0.0.1,1434
username: ps
pass: ps

kubectl port-forward pod/keycloak-d786fd4f-77mbk 18080:8080

http://localhost:8090/api/photo/photos?sortBy=date&order=desc
http://localhost:8090/api/photo/photos/1

realm:skal
http://localhost:18080/realms/skal/protocol/openid-connect/auth
http://localhost:18080/realms/skal/protocol/openid-connect/token
client id: ps
user:ps PS_USER realm roleal
client secret: fn41Zt7X3zWGas71RNazJ79Eibli7hDd


This is the backend for a photo album app.

The features of the app essentially is user management, and CRUD functionality for photos. Here is the detailed functionality:
-Uploading, deleting photos.
-List the names and dates of photos, sorted either by name or by date.
-Clicking on a list item should display the corresponding image.
-User management (registration, login, logout).
-Uploading and deleting are only permitted for logged-in users

The api of the app is defined in ps_api.yaml. using openapi-genrator-maven-plugin the api is generated, and then implemented in PhotoServiceController.
PhotoServiceController then calls PhotoServiceImpl.



C:\Windows\System32>oc login https://console-openshift-console.apps.rm3.7wse.p1
error: dial tcp: lookup console-openshift-console.apps.rm3.7wse.p1: no such host - verify you have provided the correct host and port and that the server is currently running.

C:\Windows\System32>oc login https://api.rm3.7wse.p1.openshiftapps.com:6443
You must obtain an API token by visiting https://oauth-openshift.apps.rm3.7wse.p1.openshiftapps.com/oauth/token/request

Alternatively, use "oc login --web" to login via your browser. See "oc login --help" for more information.

C:\Windows\System32>
C:\Windows\System32>oc login https://api.rm3.7wse.p1.openshiftapps.com:6443 --web
Opening login URL in the default browser: https://oauth-openshift.apps.rm3.7wse.p1.openshiftapps.com/oauth/authorize?client_id=openshift-cli-client&code_challenge=3f2gOQEIJmpaibrchgdHrtIwRSCwLY1pL31oX6pQdVA&code_challenge_method=S256&redirect_uri=http%3A%2F%2F%5B%3A%3A1%5D%3A63382%2Fcallback&response_type=code
Login successful.

You have access to the following projects and can switch between them with 'oc project <projectname>':

  * bbitai-dev
    openshift-virtualization-os-images
    sandbox-shared-models

Using project "bbitai-dev".

C:\Windows\System32>




oc apply -f manifest_without_apps.yaml
oc create route edge sqlserverroute --service=sqlserver --hostname=sqlserver
oc get routes -n bbitai-dev
oc port-forward svc/sqlserver 1434:1433
oc rollout restart deployment/keycloak -n bbitai-dev

worked:
https://felho-lab-git-bbitai-dev.apps.rm3.7wse.p1.openshiftapps.com/photos?sortBy=date&order=desc
curl -H "Authorization: Bearer sha256~XiHLFSPkjw-pJrpnd2EYDOHerGkLWXB20JovK8WPXLE" "https://api.rm3.7wse.p1.openshiftapps.com:6443/apis/user.openshift.io/v1/users/~"
http://keycloak-bbitai-dev.apps.rm3.7wse.p1.openshiftapps.com


worked2:
https://felho-lab-git-bbitai-dev.apps.rm3.7wse.p1.openshiftapps.com
https://felho-lab-ui-git7-bbitai-dev.apps.rm3.7wse.p1.openshiftapps.com/ui/

realm:photo
https://keycloak-bbitai-dev.apps.rm3.7wse.p1.openshiftapps.com/realms/photo/protocol/openid-connect/auth
https://keycloak-bbitai-dev.apps.rm3.7wse.p1.openshiftapps.com/realms/photo/protocol/openid-connect/token
client id: ps
user:ps PS_USER realm roleal
ps client secret: GAnRJaCqJ7q1xsRV6z4NXIto0t4YekRY
ui clientnek nincs
token id: credentials
add token to: headers
header prefix: Bearer